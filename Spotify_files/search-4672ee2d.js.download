import{r as L}from"./stimulus-helpers-50266f37.js";import{C as h}from"./js.cookie-c0fbedcc.js";import{E as w}from"./ez-base-controller-29e49ea5.js";import{e as n}from"./events-1a058a8a.js";import{t as o,j as b,z as A,x as E,B as g,S as k,e as m,h as f,r as P,a as p,T as _}from"./helpers-a84f7625.js";import{F as v}from"./filters-state-f42aad59.js";import{d as I}from"./partner-popup-helpers-1f35ef94.js";import{i as F}from"./search-helpers-68c4a0d8.js";import{S as x}from"./scroll-position-helpers-b1f25bb6.js";import{sendTrackingEvent as d,trackCompleteEvent as T}from"./tracking-0dbb49c1.js";import{as as R,at as z,au as $,av as q,aw as H,ax as U}from"./actions-6b3b15bd.js";import"./_commonjsHelpers-de833af9.js";import"./init-user-05a6553c.js";import"./partner-id-helpers-1c8ec9a7.js";class M extends w{constructor(){super(...arguments),this.applySearchFilters=e=>{this.resetContentType(e),h.set("ezSearchType","internal");const t=window.filtersState.getFlatQueryString(),r=this.unverifiedPath||this.changingContentType()?this.getNewSearchUrl(this.searchRoute,this.searchTerm,t):`${window.location.pathname}${t}`;window.Turbolinks.visit(r)},this.postAjaxEvent=e=>{this.postAjax(e.detail.dataHash)},this.searchPaginationEvent=e=>{o("PaginationChanged",{page:e.detail.page,stateKey:"search-state",extraStates:["filterState"],ajaxEventName:"PostSearchAjax",resultsTarget:document.querySelector(".search-results")})},this.performSearch=e=>{const{searchPath:t}=e.detail,r=e.detail.searchRoute?e.detail.searchRoute:this.searchRoute,s=this.normalizeTerm(e.detail.term);this.resetContentType(e);const i=e.detail.useSearchState?window.filtersState.getFlatQueryString().substring(1):null,a=t||this.getNewSearchUrl(r,s,i);e.detail.searchInNewTab===!0?window.open(a,"_blank"):window.Turbolinks.visit(a)},this.resetContentType=e=>{this.contentType=e.detail.contentType||this.contentType,e.detail.contentType&&h.set("content_type",e.detail.contentType),this.changingContentType()&&window.filtersState.resetStateToDefault()},this.postAjax=e=>{window.filtersState.updateStateValue("page",e.page);const t=window.filtersState.getFlatQueryString(),r=this.getNewSearchUrl(this.searchRoute,this.searchTerm,t);this.searchType&&h.set("ezSearchType",this.searchType),window.location.assign(r)},this.trackSearchClick=e=>{const t=e.target.closest(".search-results .ez-search-results .ez-resource-grid__item");t&&o(n.search.click,{resourceId:t.getAttribute("data-item-id"),resourcePosition:t.getAttribute("data-position"),resourcePro:t.getAttribute("data-pro"),searchTerm:this.searchTerm})},this.trackSponsoredSearchClick=e=>{const t=e.target.closest(".search-results .ez-sponsored-results .ez-resource-grid__item");t&&o(n.search.sponsored_click,{resourceId:t.getAttribute("data-item-id"),resourcePosition:t.getAttribute("data-position"),resourcePro:"",searchTerm:this.searchTerm,sponsored:!0})}}connect(){var e;window.filtersState=(e=window.filtersState)!=null&&e.isSearchState()?window.filtersState:new v,this.searchFormInput=document.querySelector('[data-search-form-target="input"]'),this.searchFormInput&&(this.contentType=this.searchFormInput.getAttribute("data-content-type"),window.location.href.indexOf("/free-png/")>-1&&(this.contentType="png")),window.addEventListener("PostSearchAjax",this.postAjaxEvent),window.addEventListener("SearchPaginationChange",this.searchPaginationEvent),window.addEventListener("Searched",this.performSearch),window.addEventListener("click",this.trackSearchClick),window.addEventListener("click",this.trackSponsoredSearchClick),window.addEventListener(n.search.apply_filters,this.applySearchFilters),window.addEventListener(n.search.update_content_type,this.resetContentType)}disconnect(){window.removeEventListener("PostSearchAjax",this.postAjaxEvent),window.removeEventListener("SearchPaginationChange",this.searchPaginationEvent),window.removeEventListener("Searched",this.performSearch),window.removeEventListener("click",this.trackSearchClick),window.removeEventListener("click",this.trackSponsoredSearchClick),window.removeEventListener(n.search.apply_filters,this.applySearchFilters),window.removeEventListener(n.search.update_content_type,this.resetContentType)}changingContentType(){return this.contentType!==this.searchFormInput.getAttribute("data-content-type")}getNewSearchUrl(e,t,r){const s=t.match(/url:.*/)||t.match(/id:.*/);if(window.location.pathname.includes("search_by_image")&&s)return`${window.location.pathname}${r}`;const i=e,a=[];return e===this.searchRoute&&a.push(`qterm=${t}`,`content_type=${this.contentType}`),r&&r.replace(/^\?/,"").split("&").forEach(u=>{a.push(u)}),a.length>0?`/${i}?${a.join("&")}`:i}footerPagerChange(e){e.preventDefault();const t=document.querySelector('[data-ez-num-pager-target="currentPage"]'),r=b(t)+1;o("SearchPaginationChange",{page:r})}normalizeTerm(e){return encodeURIComponent(e.toLowerCase().trim().replace(/ /g,"-"))}get searchRoute(){return this.searchFormInput?this.searchFormInput.getAttribute("data-search-route"):"search"}get searchTerm(){const e=this.element.querySelector("[data-search-term]");return e?e.getAttribute("data-search-term"):""}get searchType(){const e=this.element.querySelector("[data-search-type]");return e?e.getAttribute("data-search-type"):null}get unverifiedPath(){return window.location.pathname===`/${this.searchRoute}`}}class y extends w{constructor(){super(...arguments),this.navigationKeyCodes=["ArrowUp","ArrowLeft","ArrowRight","ArrowDown","Enter"],this.exclusionKeyCodes=["MetaLeft","MetaRight","ControlLeft","ControlRight","AltLeft","AltRight","ShiftLeft","ShiftRight"],this.wrapperToggleClasses=["inline-filters","inline-filters__arrow","inline-filters__current"],this.focusSearchField=e=>{e.target,e.currentTarget},this.scrollToSearch=()=>{if(this.isMobile()&&A()){const t=this.inputTarget.getBoundingClientRect().top+window.scrollY-20;E(t)}},this.updateSearchSwatch=e=>{const t=e.detail.color;this.searchFormColorSwatches.forEach(r=>{r.parentElement.classList.add("ez-search-form__searched-color--active"),r.style.backgroundColor=`#${t}`})},this.resetColorSwatchFilter=()=>{this.searchFormColorSwatches.forEach(e=>{e.parentElement.classList.remove("ez-search-form__searched-color--active"),e.style.backgroundColor=""}),o("resetColorSwatchFilter")},this.resizeInput=()=>{this.inputTarget.value?this.hiddenInputHolderTarget.textContent=this.inputTarget.value:(this.inputTarget.placeholder=this.savedPlaceholder||this.inputTarget.placeholder,this.inputTarget.setAttribute("aria-label",this.savedPlaceholder||this.inputTarget.placeholder),this.hiddenInputHolderTarget.textContent=this.inputTarget.placeholder),g()&&this.repositionColorSwatch()},this.repositionColorSwatch=()=>{this.searchFormColorSwatches.forEach(e=>{e.parentElement.style.left=`${this.hiddenInputWidth||1}px`})},this.handleInputClick=()=>{this.inputTarget.value.length>=2&&this.queryAutocomplete(this.inputTarget.value)},this.removeAutoFocus=e=>{k(e)||this.element.classList.remove("is-auto-focused")},this.setTogglesFromState=()=>{const e=window.filtersState.getRawParamKeyValues();[...this.element.querySelectorAll(".ez-input--checkbox input")].forEach(r=>{const s=r.closest(".ez-input--checkbox").getAttribute("data-filter-param");e.includes(s)&&this.setActiveFilter(r)})},this.clearPreviousSearches=()=>{this.previousSearchesTarget.classList.add("is-hidden"),window.localStorage.removeItem("previous_searches")},this.handleFilterClick=e=>{this.wrapperToggleClasses.forEach(t=>{e.target.classList.contains(t)&&this.toggleInlineFilters()})},this.setActiveFilter=e=>{const t=[...this.element.querySelectorAll("input")],r=e.closest(".inline-filters__item");t.forEach(s=>{s.checked=!1}),e.checked=!0,m()<=635?(this.currentLabelTarget.innerHTML="",this.currentLabelTarget.appendChild(r.querySelector("svg").cloneNode(!0))):this.currentLabelTarget.textContent=r.dataset.selected,this.inputTarget.placeholder=r.dataset.searchSelected,this.inputTarget.setAttribute("aria-label",r.dataset.searchSelected),this.hasPopularSearchesLinkTarget&&(this.popularSearchesLinkTarget.dataset.popularTypes.includes(e.value)?this.popularSearchesTarget.classList.remove("is-hidden"):this.popularSearchesTarget.classList.add("is-hidden"),this.popularSearchesLinkTarget.href=r.dataset.popularSearchPath,this.popularSearchesLinkTarget.textContent=r.dataset.popularSearchText,this.popularSearchesLinkTarget.setAttribute("data-english-label",r.dataset.englishLabel)),o(n.search.update_content_type,{contentType:e.value})},this.handleFilterOptionClick=e=>{this.setActiveFilter(e.target),window.filtersState.omittedFromState(e.target.getAttribute("name"))||window.filtersState.updateParamKey(`${e.target.getAttribute("name")}-${e.target.getAttribute("value")}`),this.toggleInlineFilters(),document.body.classList.contains("searches-show")?f()?P("content_type",e.target.value):window.filtersState.omittedFromState(e.target.getAttribute("name"))?o(n.search.apply_filters,{contentType:e.target.value}):this.submit(e):(this.updateContentType(e.target.value),this.autoFocusSearchForm()),this.trackContentTypeSelection(e.target)},this.handlePopularSearchesLinkClick=e=>{this.trackPopularSearchClick(e)},this.toggleInlineFilters=()=>{this.inlineFiltersTarget.classList.toggle("is-open")},this.blurInlineFilters=e=>{this.inlineFiltersTarget.classList.contains("is-open")&&!e.target.closest(".ez-search-form .inline-filters")&&this.toggleInlineFilters()},this.handleInputKeyUp=e=>{!this.exclusionKeyCodes.includes(e.code)&&!this.navigationKeyCodes.includes(e.code)&&this.checkAndToggleIsTyped(),g()&&this.searchFormColorSwatches.forEach(t=>{t.style.backgroundColor!==""&&setTimeout(()=>{t.parentElement.classList.add("ez-search-form__searched-color--active")},600)}),this.navigationKeyCodes.includes(e.code)&&document.querySelector(".ez-search-form__suggestions li")?this.navigateSuggestions(e.code):!this.exclusionKeyCodes.includes(e.code)&&this.inputTarget.value.length>=2?this.queryAutocomplete(this.inputTarget.value):this.autocompleteSuggestionsTarget.innerHTML!==""&&this.resetAutocomplete()},this.handleInputKeyDown=e=>{e.metaKey&&e.code==="Enter"&&this.submit(e)},this.handleSuggestionClick=e=>{this.inputTarget.value=e.currentTarget.textContent,e.currentTarget.parentElement===this.autocompleteSuggestionsTarget&&this.data.set("lastActiveAutocompleteTerm",e.currentTarget.textContent),this.submit(e)},this.navigateSuggestions=e=>{const t=this.autocompleteSuggestionsTarget,r=t.querySelector("li.is-active"),s=this.previousSearchTermsTarget,i=s.querySelector("li.is-active"),a=c=>{let l=this.autocompleteSuggestionsTarget.querySelector("li.is-active");l||(l=this.previousSearchTermsTarget.querySelector("li.is-active")),l&&l.classList.remove("is-active"),c&&(c.classList.add("is-active"),this.data.set("lastActiveAutocompleteTerm",c.textContent),this.inputTarget.value=c.textContent)},u=c=>{this.previousSearchesTarget.classList.contains("is-hidden")?a(c==="navDown"?t.querySelector("li:first-of-type"):t.querySelector("li:last-of-type")):a(s.querySelector("li:first-of-type"))};e==="ArrowUp"?(()=>{i?a(t.querySelector("li:last-of-type")):r&&r.previousSibling?a(r.previousSibling):u("navUp")})():e==="ArrowDown"?(()=>{r&&r.nextSibling?a(r.nextSibling):r&&!r.nextSibling?u("navDown"):a(t.querySelector("li:first-of-type"))})():e==="ArrowRight"?(()=>{i&&(i.nextElementSibling&&(m()<=750||i.getBoundingClientRect().top===i.nextElementSibling.getBoundingClientRect().top)?a(i.nextElementSibling):a(s.querySelector("li:first-of-type")))})():e==="ArrowLeft"?(()=>{if(i)if(i.previousElementSibling)a(i.previousElementSibling);else if(m()<=750)a(s.querySelector("li:last-of-type"));else{const c=i.getBoundingClientRect().top;let l;s.querySelectorAll("li").forEach(S=>S.getBoundingClientRect().top!==c?!1:(l=S,!0)),a(l)}})():e==="Enter"&&this.resetAutocomplete()},this.resetAutocomplete=()=>{this.data.set("lastTerm",""),this.autocompleteSuggestionsTarget.innerHTML="",this.formTarget.classList.remove("is-suggesting")},this.queryAutocomplete=e=>{if(e===this.data.get("lastTerm"))return;this.data.set("lastTerm",this.inputTarget.value);const t=new XMLHttpRequest,r=this.inputTarget.getAttribute("data-autocomplete-content-type");t.open("GET",`${this.autocompleteUrl}?term=${encodeURI(e)}&content_type=${r}`,!0),t.setRequestHeader("Content-Type","text/plain"),t.onload=()=>{try{this.renderAutocomplete(JSON.parse(t.response),e)}catch(s){console.error(s)}},t.send()}}connect(){var e;window.filtersState=(e=window.filtersState)!=null&&e.isSearchState()?window.filtersState:new v,window.filtersState.addPopStateListener(),window.EezyStickyScrollPositionHelper||(window.EezyStickyScrollPositionHelper=x),this.autocompleteUrl=this.inputTarget.dataset.autocompleteSource,!this.isMobile()&&!document.body.classList.contains("custom_design_landing_pages-show")&&this.autoFocusSearchForm(),!this.isMobile()&&window.EezyScrollPositionHelper&&window.EezyScrollPositionHelper.allowFocus()&&window.EezyScrollPositionHelper.resetScrollPosition(),g()&&(this.searchFormColorSwatches=document.querySelectorAll('[data-search-form-target="searchedColor"]'),window.addEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch)),this.hasInlineFiltersTarget&&this.setupInlineFilters(),this.checkAndToggleIsTyped(),this.inputTarget.classList.add("is-ready"),this.inputTarget.addEventListener("blur",this.resizeInput),this.inputTarget.addEventListener("keyup",this.resizeInput),this.inputTarget.addEventListener("keydown",this.resizeInput),this.inputTarget.addEventListener("click",this.removeAutoFocus),this.inputTarget.addEventListener("keydown",this.removeAutoFocus),window.addEventListener(n.search.clear_searches,this.clearPreviousSearches),this.inputTarget.value&&this.resizeInput(),this.setPreviousSearches(),this.inputTarget.addEventListener("click",this.handleInputClick),this.flagLoaded(),this.trackSitelinksSearch(),f&&this.trackSearchSimilarImageComplete()}disconnect(){document.removeEventListener("click",this.blurInlineFilters),this.inputTarget.removeEventListener("blur",this.resizeInput),this.inputTarget.removeEventListener("keyup",this.resizeInput),this.inputTarget.removeEventListener("keydown",this.resizeInput),this.inputTarget.removeEventListener("click",this.removeAutoFocus),this.inputTarget.removeEventListener("keydown",this.removeAutoFocus),window.removeEventListener(n.search.clear_searches,this.clearPreviousSearches),window.removeEventListener("updateEzSearchFormColorSwatch",this.updateSearchSwatch),this.inputTarget.removeEventListener("click",this.handleInputClick)}setupInlineFilters(){this.setLandingPageInlineFilterDefaults(),document.addEventListener("click",this.blurInlineFilters)}get hiddenInputWidth(){return Math.ceil(this.hiddenInputHolderTarget.getBoundingClientRect().width)}autoFocusSearchForm(){setTimeout(()=>{const e=this.inputTarget.value;this.inputTarget.value="",this.inputTarget.focus(),this.inputTarget.value=e,this.element.classList.add("is-auto-focused")},0)}setLandingPageInlineFilterDefaults(){document.body.classList.contains("resource-landing")?window.filtersState.resetStateToDefault():this.setTogglesFromState()}setPreviousSearches(){const e=JSON.parse(this.previousSearchTermsTarget.dataset.recentSearches);if(e.length>0){this.addPreviousSearchElements(e,!1);return}const t=window.localStorage.getItem("previous_searches");if(t){const r=JSON.parse(t);this.addPreviousSearchElements(r,!0);return}this.previousSearchesTarget.classList.add("is-hidden")}addPreviousSearchElements(e,t){for(let r=0;r<e.length;r+=1){const s=t?JSON.parse(e[r]):e[r],i=`
        <li class="ez-btn ez-btn--light ez-btn--small" data-action="click->search-form#handleSuggestionClick"
            data-content-type="${s.contentType}">${s.term}</li>`;this.previousSearchTermsTarget.insertAdjacentHTML("beforeend",i)}}handlePreviousClickBlur(e){e.preventDefault()}trackContentTypeSelection(e){d({element:e,data:{action:R,label:e.value,category:document.body.dataset.conversionsCategory}})}updateContentType(e){this.inputTarget.setAttribute("data-content-type",e),o(n.search.update_content_type,{contentType:e})}trackPopularSearchClick(e){const t=this.inputTarget.getAttribute("data-content-type"),r=e.target.getAttribute("data-english-label");d({element:e.target,data:{action:z,label:`Link-${r}`,content_type:`Content-${t}`}})}checkAndToggleIsTyped(){this.searchInputContents?this.element.classList.add("is-typed"):this.element.classList.remove("is-typed")}renderAutocomplete(e,t){if(this.autocompleteSuggestionsTarget.innerHTML="",this.formTarget.classList.add("is-suggesting"),e.length===0){this.resetAutocomplete();return}h.set("last_search_autocomplete_results",e,{expires:1}),Object.keys(e).forEach(r=>{const s=document.createElement("LI"),i=t.toLowerCase();e[r].indexOf(i)>=0?s.innerHTML=e[r].replace(i,`<strong>${i}</strong>`):s.innerHTML=e[r],s.dataset.action="mousedown->search-form#handleSuggestionClick",this.autocompleteSuggestionsTarget.appendChild(s)})}isMobile(){return document.body.classList.contains("is-mobile")}resetPagination(){window.filtersState.updateStateValue("page",1)}submitViaButton(e){e.preventDefault(),this.submit(e)}submit(e){if(this.inputTarget.value.length===0||this.element.hasAttribute("data-disable-form-submit"))return;this.resetPagination();const t={term:this.inputTarget.value,searchRoute:this.inputTarget.getAttribute("data-search-route"),useSearchState:!0,contentType:this.inputTarget.getAttribute("data-content-type"),searchInNewTab:!1};e.metaKey&&e.code&&e.code==="Enter"&&(t.searchInNewTab=!0),h.set("ezSearchType","internal"),o("Searched",t),this.savePreviousSearch(t),this.trackSearchComplete(),this.inputTarget.value===this.data.get("lastActiveAutocompleteTerm")&&this.trackAutoSuggestSearch(e),I({searchTerm:this.inputTarget.value}),F()}savePreviousSearch(e){let t=JSON.parse(window.localStorage.getItem("previous_searches"));t||(t=[]);for(let r=0;r<t.length;r+=1)if(JSON.parse(t[r]).term===e.term){t.splice(r,1);break}t.unshift(JSON.stringify(e))>6&&t.pop(),window.localStorage.setItem("previous_searches",JSON.stringify(t))}trackManualSearchClick(e){this.element.hasAttribute("data-disable-form-submit")||d({element:e.target,data:{action:$,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${p()}`}})}trackAutoSuggestSearch(e){d({element:e.target,data:{action:q,label:`Terms-${this.inputTarget.value}`,content_type:`Content-${p()}`}});const t=new XMLHttpRequest;t.open("POST",`${this.autocompleteUrl}?original_term=${this.data.get("lastTerm")}&selected_term=${this.data.get("lastActiveAutocompleteTerm")}&content_type=${p()}`,!0),t.send()}trackSearchComplete(e=""){const t=[".search-results__meta__results-info",".search-results__header--no-results"];T({action:H,label:`${e}Terms-${this.inputTarget.value}`,valueElementSelector:t,valueAttribute:"search-results-count",dimensions:{content_type:`Content-${p()}`}})}trackSitelinksSearch(){if(!this.element.parentNode.parentNode.classList.contains("ez-site-header")){const e=this.fromSitelinks;e==="sitelinks "&&this.trackSearchComplete(e)}}trackSearchSimilarImageComplete(){new URLSearchParams(window.location.search).get("similar_image_search")==="true"&&T({action:U,dimensions:{content_type:"Content-image"}})}get resultsCount(){const e=document.querySelector("[data-search-results-count]");return e?e.getAttribute("data-search-results-count"):null}get pageNumber(){const e=_();return e||"1"}get searchTerm(){return this.element.getAttribute("data-search-term").replace(/ /g,"-")}get searchType(){return this.element.getAttribute("data-search-type")}get searchContentType(){return this.inputTarget.getAttribute("data-content-type")}get searchInputContents(){return this.inputTarget.value}get fromSitelinks(){const t=new URLSearchParams(window.location.search).get("referral");return!t||t!=="sitelinks_searchbox"?"":"sitelinks "}}y.targets=["form","input","submit","currentLabel","popularSearches","popularSearchesLink","inlineFilters","previousSearches","hiddenInputHolder","previousSearchTerms","autocompleteSuggestions"];L([["ez-search",M],["search-form",y]]);
