import{C as S}from"./js.cookie-c0fbedcc.js";import{getAnalyticsDimensions as k,getPageviewGuid as V,TRACKING_EVENT_NAME as h,findCategoryByElement as O,dataLayerPush as T,getCompleteEventSources as N,deleteCompleteEventSources as L}from"./tracking-0dbb49c1.js";import{aM as j}from"./actions-6b3b15bd.js";import{T as U,E as R}from"./helpers-a84f7625.js";import"./_commonjsHelpers-de833af9.js";import"./init-user-05a6553c.js";const{gtag:x}=window,F=({schema:a,eventData:r,userStateData:i})=>{window.snowplow("trackSelfDescribingEvent",{schema:a,data:r},i)},M=({category:a,action:r,label:i="",property:l=null,value:g=null,customContext:u=null})=>{window.snowplow("trackStructEvent",a,r,i,l,g,u)},q=({title:a=null,customContext:r=[],contextFunc:i=null})=>{window.snowplow("trackPageView",a,r,i)},B=({namespace:a,collectorEndpoint:r,config:i={}})=>{window.snowplow("newTracker",a,r,i)},G=({cookieId:a})=>{window.snowplow("setUserIdFromCookie",a)},H=({minimumVisitLength:a,heartbeatDelay:r})=>{window.snowplow("enableActivityTracking",a,r)},J=()=>{window.snowplow("enableLinkClickTracking")},p={trackSelfDescribingEvent:F,trackStructEvent:M,trackPageView:q,newTracker:B,setUserIdFromCookie:G,enableActivityTracking:H,enableLinkClickTracking:J},z="iglu:com.eezy/user_state/jsonschema/1-0-7",K="iglu:com.eezy/resource_impressions/jsonschema/1-0-0",W="iglu:com.eezy/turbolinks_timing/jsonschema/1-0-0";function $({collector:a,appId:r}){let i=0,l="";const g=()=>{const e={ids:[],pros:[],page:0},n=U();return document.querySelectorAll("[data-item-id]").forEach(t=>{const{itemId:o,pro:s}=t.dataset;e.ids.push(parseInt(o,10)),R(s)?e.pros.push(1):e.pros.push(0)}),n?e.page=parseInt(n,10):delete e.page,e},u=({includeFlags:e=!1,includeExpandedDataset:n=!1,errorText:t=null}={})=>{const{bot_score:o,feature_flags:s,ja3_hash:d,js_detect_passed:E,sign_in_type:f,split_test:w,user_auth_id:_,user_status_start:C,user_status_updated:A,verified_bot:I}=k(),[P,D]=w.split(":"),c={pageviewGuid:V(),fingerprint:S.get("apolloFP")};return e&&(c.flags=s),t&&(c.errorText=t),n&&(c.botScore=o,c.ja3Hash=d,c.jsDetectPassed=E,c.signInType=f,c.splitTestName=P,c.splitTestVariant=D,c.statusStart=C,c.statusUpdated=A,c.userAuthId=_,c.verifiedBot=I),[{schema:z,data:c}]},b=()=>{const e=g();e.ids.length>0&&p.trackSelfDescribingEvent({schema:K,eventData:e,userStateData:u()})},m=()=>i>=1,y=e=>{if(!m())return!1;const n={visitDur:e.data.timing.visitEnd-e.data.timing.visitStart,reqDur:e.data.timing.requestEnd-e.data.timing.requestStart,prevUrl:l,visitNo:i};return p.trackSelfDescribingEvent({schema:W,eventData:n,userStateData:u()}),!0},v=e=>{this.trackPageView(),b(),y(e)};this.trackEvent=({category:e,action:n,label:t=null,value:o=null,contentType:s=null,errorText:d=null})=>{p.trackStructEvent({category:e,action:n,label:t,property:s,value:o,customContext:u({errorText:d})})},this.trackPageView=()=>{p.trackPageView({contextFunc:()=>u({includeFlags:!0,includeExpandedDataset:!0})})},this.init=()=>{p.newTracker({namespace:"cf",collectorEndpoint:a,config:{appId:r,discoverRootDomain:!0,eventMethod:"beacon",contexts:{webPage:!0,performanceTiming:!0,gaCookies:!0,geolocation:!1}}}),p.setUserIdFromCookie({cookieId:"session_guid"}),p.enableActivityTracking({minimumVisitLength:10,heartbeatDelay:10}),p.enableLinkClickTracking(),window.addEventListener("turbolinks:visit",()=>{i+=1}),window.addEventListener("turbolinks:request-start",()=>{l=window.location.pathname}),window.addEventListener("turbolinks:load",v)},this.disconnect=()=>{window.removeEventListener("turbolinks:load",v)}}function Q(){const a="turbolinks:render";let r;const i=(e,n)=>{if(document.body.dataset.env==="test"){const o=S.get("googleEventsSent")||"[]",s=JSON.parse(o);s.push({event_action:e,...n}),S.set("googleEventsSent",JSON.stringify(s),{domain:".example.com"})}x("event",e,{...k(),...n});const t={category:n.event_category,action:e};Object.hasOwnProperty.call(n,"event_label")&&(t.label=n.event_label),Object.hasOwnProperty.call(n,"value")&&(t.value=n.value),Object.hasOwnProperty.call(n,"content_type")&&(t.contentType=n.content_type),Object.hasOwnProperty.call(n,"error_text")&&(t.errorText=n.error_text),r.trackEvent(t)},l=e=>{const{action:n,category:t,label:o,dataLayer:s,...d}=e.detail,E=e.target||document.body,w={event_category:t||O(E),...d};o&&(w.event_label=o),i(n,w),s&&T(s)},g=(e,n)=>{const t=()=>e.find(d=>!!document.querySelector(d)),o=Array.isArray(e)?t():e;return document.querySelector(o).getAttribute(`data-${n}`)},u=()=>{const e=N();if(!e||!Array.isArray(e)){L();return}e.forEach(n=>{const t=JSON.parse(decodeURIComponent(JSON.stringify(n).replace(/\+/g," ")));if(t.valueElementSelector&&t.valueAttribute){const o=g(t.valueElementSelector,t.valueAttribute);t.value=o,delete t.valueElementSelector,delete t.valueAttribute}if(t.dataLayerCompleteAttrs){const o=k();t.dataLayer=t.dataLayer||[],t.dataLayerCompleteAttrs.forEach(s=>{t.dataLayer[s]=o[s]||""}),delete t.dataLayerCompleteAttrs}l({detail:t})}),L()},b=()=>{const{user_status_start:e,user_status_updated:n,user_plan:t,user_survey:o,split_test:s,test_block:d,feature_flags:E}=k(),{conversionsLabel:f,conversionsContentType:w}=document.body.dataset,_={action:j,page_title:document.title,page_location:window.location.href,page_path:window.location.pathname,user_status_start:e,user_status_updated:n,user_plan:t,user_survey:o,split_test:s,test_block:d,feature_flags:E};f&&(_.label=f),w&&(_.content_type=w),l({detail:_}),T()},m=()=>{b(),u()},y=()=>{const{snowplow_collector:e,snowplow_app_id:n}=k();r=new $({collector:e,appId:n}),r.init()},v=()=>m();this.init=()=>{y(),window.addEventListener("load",v),document.addEventListener(h,l),document.addEventListener(a,m)},this.disconnectEvents=()=>{window.removeEventListener("load",v),document.removeEventListener(h,l),document.removeEventListener(a,m)}}window.conversionTracker=new Q,window.conversionTracker.init();
