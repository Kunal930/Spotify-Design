var G=Object.defineProperty;var V=(a,e,t)=>e in a?G(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var l=(a,e,t)=>(V(a,typeof e!="symbol"?e+"":e,t),t);import{_ as x}from"./preload-helper-be1680a6.js";import{C as D,r as F}from"./stimulus-helpers-50266f37.js";import"./index-76fb7be0.js";import{E as y}from"./ez-base-controller-29e49ea5.js";import{T as N}from"./turbolinks-098dba5f.js";import{sendTrackingEvent as f,pushDataLayerProperties as j}from"./tracking-0dbb49c1.js";import{aN as k,ag as U}from"./actions-6b3b15bd.js";import{V as W,B as $,E,a as Q,W as J,u as w,l as m,t as K}from"./helpers-a84f7625.js";import{b as A}from"./search-helpers-68c4a0d8.js";import{b as L,a as C}from"./ajax-helpers-b23bc37b.js";import{a as P}from"./partner-popup-helpers-1f35ef94.js";import{C as X}from"./js.cookie-c0fbedcc.js";import{f as S,R as v}from"./ez-custom-events-439a5476.js";import Y from"./init-user-05a6553c.js";import{M as z}from"./media-matcher-b9d0b27a.js";import{i as Z}from"./tooltips-87e84986.js";import"./_commonjsHelpers-de833af9.js";import"./index-266db5bb.js";import"./modal_helpers-630b4868.js";import"./partner-id-helpers-1c8ec9a7.js";class _ extends y{constructor(){super(...arguments),this.gridObserver=null,this.initGrid=(e=null)=>{if(this.element.classList.contains("ez-resource-grid--partner"))return;(this.element.dataset.instantGrid!=="true"||this.element.dataset.instantGrid==="true"&&e)&&window.ezResourceGrid({gridSelector:this.element,options:{rowHeight:parseInt(this.element.getAttribute("data-row-height"),10),maxRows:parseInt(this.element.getAttribute("data-max-rows"),10),truncate:!!this.element.getAttribute("data-truncate-results")}}),this.element.querySelectorAll(".ez-resource-grid__item").forEach((i,o)=>{i.setAttribute("data-position",`${o+1}`)}),Array.from(document.querySelectorAll("link[rel=preload][as=image]")).map(i=>i.getAttribute("href")).forEach(i=>{const o=this.element.querySelector(`img[src="${i}"]`);o&&(o.removeAttribute("loading"),o.removeAttribute("decoding"),o.setAttribute("fetchpriority","high"))})},this.trackResourceClick=e=>{e.currentTarget.classList.add("is-clicked");const t=e.currentTarget.closest(".ez-resource-thumb"),r=t.dataset.pro==="true"?"Pro":"Free",i={action:k,label:r,content_type:`Content-${e.currentTarget.dataset.contentType}`};this.element.dataset.gridPage&&(i.value=this.gridItemIndex(t)),f({element:e.currentTarget,data:i}),r==="Free"&&P({searchTerm:this.searchTerm||X.get("most_recent_search")})},this.trackResourceRightClick=e=>{const t=e.target.closest(".ez-resource-thumb");if(!t)return;(t.dataset.pro==="true"?"Pro":"Free")==="Free"&&P({display:!1})},this.nopeResource=e=>{e.preventDefault(),e.stopImmediatePropagation(),L("/admin/search/search_term_options/exclude",this.afterSearchTweak,()=>{},this.stoParams(this.parseResourceId(e)))},this.excludeTerm=e=>{e.preventDefault(),e.stopImmediatePropagation();const t=prompt("enter term to exclude"),r={term:this.searchTerm,locale:this.locale,content_type:this.contentType,excluded_term:t};L("/admin/search/search_term_options/exclude_term",this.afterSearchTweak,()=>{},r)},this.stoParams=e=>({term:this.searchTerm,locale:this.locale,content_type:this.contentType,resource_id:e}),this.afterSearchTweak=()=>{window.EezyScrollPositionHelper.preservePositionOnce(),N.visit(window.location.href)}}get shouldTrackTruncation(){return this.hasTrackTruncationValue&&this.trackTruncationValue}connect(){this.initGrid(),window.addEventListener(S,this.initGrid),this.insertExcludeTermButton(),this.shouldTrackTruncation&&this.trackResourceTruncation(),this.element.addEventListener("contextmenu",this.trackResourceRightClick)}disconnect(){window.removeEventListener(S,this.initGrid),this.element.removeEventListener("contextmenu",this.trackResourceRightClick),this.gridObserver&&this.gridObserver.disconnect()}trackResourceTruncation(){if(!this.hasGridItemTarget)return;const e=this.gridItemTargets.length,t=this.gridItemTargets.filter(i=>i.style.display==="none").length,r=W(t,e);j({search_results_percent_hidden:r})}gridItemIndex(e){const t=parseInt(e.dataset.position,10),r=parseInt(this.element.dataset.gridPage,10),i=parseInt(this.element.dataset.perPageTotal,10);return r?(r-1)*i+t:null}insertExcludeTermButton(){if(!A())return;const e=document.querySelectorAll(".ez-resource-grid")[0],t=document.createElement("a"),r=document.createTextNode("exclude term");t.appendChild(r),t.dataset.action="click->resources-grid#excludeTerm",t.href="#",e.appendChild(t)}get searchTerm(){const e=document.querySelector("[data-search-term]");return e?e.getAttribute("data-search-term"):""}get locale(){return document.documentElement.getAttribute("lang")}get contentType(){return document.querySelector(".ez-search-form__input").getAttribute("data-content-type")}parseResourceId(e){return e.target.parentNode.parentNode.dataset.itemId}}_.values={trackTruncation:Boolean};_.targets=["gridItem"];class H extends y{constructor(){super(...arguments),this.addEditableLabels=()=>{const e=this.element.hasAttribute("data-editable-label-text"),r=["vector"].includes(this.contentType);this._decorateGridItem({elem:this.element,conditional:e&&$()&&r,effect:i=>{i.classList.add("ez-resource-thumb--editable-label")}})},this.addFreeLabels=()=>{const e=this.element.hasAttribute("data-free-label-text"),t=!Y.isPro,r=!E(this.element.dataset.pro);this._decorateGridItem({elem:this.element,conditional:t&&r&&e,effect:i=>{i.classList.add("ez-resource-thumb--free-label")}})},this.insertSearchDeboostingButtons=()=>{const e=`
      <div class="ez-resource-thumb__link__admin ez-resource-thumb__link__admin--nope"
            data-action="click->resources-grid#nopeResource">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.83 18.83">
          <path d="M18.83 2.83L16 0 9.41 6.59 2.83 0 0 2.83l6.59 6.58L0 16l2.83 2.83 6.58-6.59L16 18.83 18.83 16l-6.59-6.59 6.59-6.58z"/>
        </svg>
      </div>
    `;this.hasLinkTarget&&this._decorateGridItem({elem:this.linkTarget,conditional:this.element.closest(".ez-search-results")&&A(),effect:t=>{t.insertAdjacentHTML("beforeend",e)}})},this.addRemoveFromCollectionAction=()=>{const e=this.element.closest(".ez-resource-grid"),t=e==null?void 0:e.querySelector("#removeFromCollectionTemplate"),r=this.element.querySelector(".ez-resource-thumb__hover-state");this._decorateGridItem({elem:this.element,conditional:!!t&&!!r,effect:i=>{this._injectRemoveButton(i,t,r)}})},this.addCollectionDragHandle=()=>{const e=`
      <div class="ez-resource-thumb__grab__wrapper is-hidden" draggable="true">
        <svg viewBox="0 0 9.8 14" xmlns="http://www.w3.org/2000/svg">
          <g opacity=".74"><circle cx="1.5" cy="1.5" r="1.5"/>
          <circle cx="1.5" cy="7" r="1.5"/><circle cx="1.5" cy="12.5" r="1.5"/>
          <circle cx="8.3" cy="1.5" r="1.5"/><circle cx="8.3" cy="7" r="1.5"/>
          <circle cx="8.3" cy="12.5" r="1.5"/></g>
        </svg>
      </div>
    `;this._decorateGridItem({elem:this.element,conditional:this.element.hasAttribute("data-collection-item-id"),effect:t=>{t.insertAdjacentHTML("beforeend",e)}})},this._decorateGridItem=({elem:e,conditional:t,effect:r})=>{t&&e&&r(e)}}connect(){this.contentType=document.body.dataset.conversionsContentType||Q(),J(["addFreeLabels","addEditableLabels","insertSearchDeboostingButtons","addRemoveFromCollectionAction","addCollectionDragHandle"],this)}hoverThumb({currentTarget:e,params:t}){document.body.classList.contains("is-mobile")&&w()||this._decorateGridItem({elem:e,conditional:this._showHoverOverlay(e),effect:r=>{const{userId:i,userDisplayName:o,avatarSrc:s,uploadsPath:n,contentType:c,itemPro:u,imageSrc:h,pinterestUrl:g,title:b,resourceId:q}=t;let T=document.querySelector('[data-grid-item-decorator-target="hoverTemplate"]').innerHTML.trim();if(T=m(T,{user_id:i,user_display_name:o,contributor_avatar_src:s,contributor_uploads_path:n,content_type:c,item_pro:u,image_src:h,pinterest_url:g,title:b,id:q,url:n,src:s}),r.querySelector(".ez-resource-thumb__hover-state").insertAdjacentHTML("beforeend",T),s){const O={src:s},B=r.querySelector('[data-template="avatar-template"]').innerHTML.trim(),I=r.querySelector(".ez-avatar");I.classList.remove("ez-avatar--missing"),I.innerHTML=m(B,O)}K(v)}})}_injectRemoveButton(e,t,r){const{collectionItemId:i,pro:o}=e.dataset,s=e.querySelector(".ez-resource-thumb__link"),{contentType:n}=s.dataset;if(!i)return;let c=t.innerHTML.trim();c=m(c,{item_id:i,content_type:`Content-${n}`,item_pro:o?"Pro":"Free"}),r.insertAdjacentHTML("beforeend",c)}_tallResource(e){const t=parseFloat(e.closest("[data-tall-resource-breakpoint]").getAttribute("data-tall-resource-breakpoint")),r=parseFloat(e.dataset.w);return parseFloat(e.dataset.h)/r>=t}_showHoverOverlay(e){return!(this._tallResource(e)||document.body.classList.contains("is-mobile")&&w())}}H.targets=["link"];const d=new z;class M extends y{constructor(){super(...arguments),this.setNewThumbnailInfo=()=>{this.setupContribInfoTooltips()},this.reinitializeContribTooltips=()=>{this.tooltipsInitialized=!1,d.addMediaQuery("(min-width: 1024px)",this.initTooltips),d.evaluateAll(),d.addListeners()},this.initTooltips=()=>{if(!this.tooltipsInitialized){const e=this.element.querySelectorAll('.resource-action-button[data-ez-tooltip="true"]:not(.is-tipped)');e.length&&Z(e);const t=this,r=this.element.querySelectorAll('[data-resources-grid-target="nameTarget"]:not(.is-tipped)'),i='<div class="ez-spinner ez-spinner--sm ez-spinner--color-mono"></div>';x(()=>import("./tippy.esm-a79def68.js"),[]).then(o=>{const s=o.default;s(r,{content:i,allowHTML:!0,animation:"rising",interactive:!0,appendTo:document.body,placement:"bottom-start",theme:"contrib-info",delay:[250,null],duration:0,onCreate(n){n.popper.classList.add("contributor-info-tooltip")},onShow(n){t.tippyInstance=n,t.showTooltip(),n.popper.addEventListener("mouseleave",t.stopPreviewVideo)},onHide(n){t.tippyInstance=n,t.hideTooltip(),n.popper.removeEventListener("mouseleave",t.stopPreviewVideo)}}),this.tooltipsInitialized=!0}),r.forEach(o=>{o.classList.add("is-tipped")})}},this.stopPreviewVideo=e=>{const t=this.getParentLi(this.tippyInstance.reference);this.newTargetIsPreview(e.relatedTarget)||t.classList.remove("is-playing")},this.injectTooltipContent=()=>{if(this.contributorsInfo||this.pageGrids.length>1){clearInterval(this.contributorsInfoPolling);const e=this.contribInfoTemplateTarget.innerHTML,t=this.parseTemplateForContributor(e);setTimeout(()=>{this.initTooltipContent(t)},0)}},this.clickThroughToProfile=e=>{this.trackContributorClick(e)}}connect(){this.hasContribInfoTemplateTarget&&this.contributorsIds.length&&this.setupMediaQueries(),this.hasContribThumbnailsTarget&&this.setupFollowingThumbnails(),d.evaluateAll(),d.addListeners(),window.addEventListener(v,this.reinitializeContribTooltips)}disconnect(){d.removeListeners(),d.clearQueries(),window.removeEventListener(v,this.reinitializeContribTooltips)}setupContribInfoTooltips(){this.pageGrids=document.querySelectorAll('div[data-controller*="resources-grid"]:not(.ez-resource-grid--partner)');const e=document.querySelector(".ez-page-wrapper");this.contributorsIds&&((!this.hasIdCollectionTarget||this.idCollectionTarget.dataset.featuredGrid==="0")&&C("/async_contributors_info",t=>{this.contributorsInfo=t.data;const r=e?JSON.parse(e.getAttribute("data-contributors-info")):{},i={...t.data,...r};this.pageGrids.length>=1&&e&&e.setAttribute("data-contributors-info",JSON.stringify(i))},t=>{console.error(t)},{params:{contributor_ids:this.contributorsIds,preview_count:3}}),this.reinitializeContribTooltips())}setupFollowingThumbnails(){C("/async_contributors_info",e=>{this.contributorsInfo=e.data,this.gatherfollowedUsers().forEach(t=>{const r=document.querySelector(`[data-user-id="${t}"] [data-thumbnail-contributor-info-target="previewsWrap"]`),i=this.contributorsInfo[t].previews;let o="";i.forEach(s=>{const{thumb_src:n,thumb_src_2x:c,resource_path:u,resource_title:h,content_type:g,pro:b}=s;o+=this.makePreviewThumbHTML(n,c,u,h,g,b)}),r.innerHTML=o})},e=>{console.error(e)},{params:{contributor_ids:this.gatherfollowedUsers(),preview_count:3,sort:"recent"}})}get contributorsIds(){return this.hasContribInfoTemplateTarget?JSON.parse(this.contribInfoTemplateTarget.dataset.userIds):null}gatherfollowedUsers(){const e=[];return this.contribThumbnailsTargets.forEach(t=>{e.push(t.dataset.userId)}),e}showTooltip(){this.contributorsInfoPolling=setInterval(this.injectTooltipContent,100),this.injectTooltipContent()}hideTooltip(){clearInterval(this.contributorsInfoPolling),this.getParentLi(this.tippyInstance.reference).classList.remove("is-hovered")}newTargetIsPreview(e){return!(!e.hasAttribute("data-video-preview-target")||e.getAttribute("data-video-preview-target")!=="videoWrap")}initTooltipContent(e){const t=this.getTooltipContent(this.tippyInstance.popper),r=this.getParentLi(this.tippyInstance.reference);t.innerHTML=e,this.fixAvatar(),this.loadPreviewThumbs(),this.hideCountIfNull(),r.classList.add("is-hovered")}parseTemplateForContributor(e){const t=this.contributorInfoById;return t.url=t.contributor_uploads_path,t.src=t.contributor_avatar_src,m(e,t)}fixAvatar(){const e=this.getTooltipContent(this.tippyInstance.popper),t=e.querySelector(".ez-avatar"),r=e.querySelector('[data-thumbnail-contributor-info-target="avatarTemplate"]');this.contributorInfoById.contributor_avatar_src&&(t.classList.remove("ez-avatar--missing"),t.innerHTML=r.innerHTML)}hideCountIfNull(){const t=this.getTooltipContent(this.tippyInstance.popper).querySelector(".contributor-details__contributor__count");this.contributorInfoById.contributor_resource_count||t.classList.add("is-hidden")}loadPreviewThumbs(){const e=this.contributorInfoById.previews,t=this.tippyInstance.popper.querySelector('[data-thumbnail-contributor-info-target="previewsWrap"]');let r="";e.forEach(i=>{const{thumb_src:o,thumb_src_2x:s,resource_path:n,resource_title:c,pro:u,content_type:h}=i;r+=this.makePreviewThumbHTML(o,s,n,c,h,u)}),t.innerHTML=r}makePreviewThumbHTML(e,t,r,i,o,s){return`<a href="${r}"
               class="ez-resource-grid__item__contrib-info__uploads__thumb"
               data-content-type="${o}"
               data-pro="${s}"
               data-action="click->thumbnail-contributor-info#trackResourceClick">
              <img src="${e}"
                   srcset="${t} 2x, ${e} 1x" alt="${i}"></a>
              `}get contributorInfoById(){var o;const e=document.querySelector(".ez-page-wrapper"),t=e&&e.hasAttribute("data-contributors-info")?JSON.parse(e.getAttribute("data-contributors-info")):{},r=this.tippyInstance.reference.getAttribute("data-user-id");if((o=this.contributorsInfo)!=null&&o[r]&&t[r]){const s=t[r].contributor_uploads_path;this.contributorsInfo[r]=t[r],this.contributorsInfo[r].url=s}return{...t,...this.contributorsInfo||{}}[r]}getParentLi(e){return e.closest(".ez-resource-thumb")}trackContributorClick(e){f({element:e.target||e.currentTarget,data:{action:U}})}trackResourceClick(e){const{contentType:t,pro:r}=e.target.dataset;f({element:e.target,data:{action:k,label:E(r)?"Pro":"Free",content_type:`Content-${t}`}})}getTooltipHeader(e){return e.querySelector(".tippy-box[data-theme=contrib-info] .contributor-details__contributor")}getTooltipContent(e){return e.querySelector(".tippy-content")}setupMediaQueries(){d.addMediaQuery("(min-width: 1024px)",()=>{this.contributorsIds.length&&this.setupContribInfoTooltips()})}}M.targets=["contribInfoTemplate","contribThumbnails","idCollection","avatarTemplate"];const p=new z;class R extends D{constructor(){super(...arguments);l(this,"videoSelector",'[data-video-preview-target*="preview"]');l(this,"addPreviewEvents",()=>{this.previewTargets.forEach(t=>{t.addEventListener("mouseenter",this.playVideo,!1),t.addEventListener("mouseleave",this.maybePauseVideo,!1)})});l(this,"removePreviewEvents",()=>{this.previewTargets.forEach(t=>{t.removeEventListener("mouseenter",this.playVideo),t.removeEventListener("mouseleave",this.maybePauseVideo)})});l(this,"pauseHiddenVideos",t=>{this.element.querySelectorAll("video").forEach(i=>{i!==t.target&&this.pauseVideo(i,!0)})});l(this,"playVideo",t=>{t.stopPropagation();const r=t.currentTarget;r.querySelector("video")||this.addVideoToDOM(r),this.videoPlayIntent=setTimeout(()=>{const i=r.querySelector("video"),o=i.play();o!==void 0&&o.then(()=>{i.loop=!0,i.readyState>=3&&r.classList.add("is-playing")})},150)});l(this,"maybePauseVideo",t=>{clearTimeout(this.videoPlayIntent);const r=t.currentTarget.querySelector("video");r&&!r.closest(this.videoSelector).classList.contains("is-hovered")&&this.pauseVideo(r,!0)})}connect(){if(!this.hasPreviewTarget)return!1;this.setupPreviewMediaQueries(),document.addEventListener("play",this.pauseHiddenVideos,!0),p.evaluateAll(),p.addListeners()}disconnect(){this.removeListeners(),p.removeListeners(),p.clearQueries()}removeListeners(){document.removeEventListener("play",this.pauseHiddenVideos),this.removePreviewEvents()}addVideoToDOM(t){const{videoUrl:r}=t.dataset,i=`<div class="video-wrapper">
                        <video autoplay="true" preload="none" muted playsinline>
                          <source src="${r}" type="video/mp4">
                        </video>
                      </div>`;t.querySelector('[data-video-preview-target*="videoWrap"]').insertAdjacentHTML("beforeend",i)}isPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}pauseVideo(t,r=!1){if(t&&this.isPlaying(t)){t.closest(this.videoSelector).classList.remove("is-playing"),t.pause();const i=t.querySelector("source"),o=i.src;i.src="",i.removeAttribute("src"),t.load(),i.src=o,t.pause(),r&&(t.currentTime=0)}}setupPreviewMediaQueries(){p.addMediaQuery("(min-width: 1024px)",()=>{this.addPreviewEvents()},()=>{this.removePreviewEvents()})}}l(R,"targets",["preview"]);F([["grid-item-decorator",H],["resources-grid",_],["thumbnail-contributor-info",M],["video-preview",R],["pinterest-share",x(()=>import("./pinterest-share-controller-99b6837b.js"),[])]]);
